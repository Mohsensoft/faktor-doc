.. meta::
   :description: ارتباط به سامانه مودیان مالیاتی کشور با نرم افزار فاکتور

.. _mtax:

ارتباط با سامانه مودیان
===========================

سامانه‌ی مؤدیان مالیاتی سازمان مالیاتی کشور سامانه‌ای است تا مؤدیان مالیاتی بتوانند پایانه‌های فروشگاهی خود را به این سامانه متصل کنند، در این سامانه برای هر مودی یک کارپوشه در نظر گرفته شده است که می توانند عملیات ارسال صورت‌حساب الکترونیکی خود را انجام دهند.

نرم افزاری محسن برای انجام این عملیات توسط کابران این امکان را به نرم افزار فاکتور افزوده است که میتوانید به راحتترین، ارزانترین و ساده ترین روش صورت حسابهای خود را به سامانه مودیان ارسال نمایید.

با مطالعه این قسمت براحتی میتوانید از ارتباط را برای نرم افزار تنظیم نمایید:


.. _setting:

تنظیم سامانه مودیان و نرم افزار فاکتور
--------------------------------------------

1. ابتدا وارد لینک زیر شوید و دو فایل کلید عمومی (public_key) و کلید خصوص (private_key) را دریافت نمایید و در یک محل امن و مطمئن ذخیره نمایید :
    
    |gen_csr|

2. سپس به لینک زیر (کارپوشه -> عضویت -> شناسه های یکتای حافظه مالیاتی) رفته و روی گزینه "دریافت شناسه یکتا حافظه مالیاتی" کلیک کنید و با انتخاب "توسط مودی" در مرحله اول و انتخاب فایل کلید عمومی که در مرحله قبل گرفتید برای مرحله دوم و تیک دار کردن کد پستی در مرحله سوم و انتخاب گزینه "اتمام"  به شما یک شناسه حدود شش کاراکتری میدهد.

    |membership_normalUniqueID|

3. این شناسه را در قسمت مشخصات صادر کننده در نرم افزار فاکتور در فیلد "شناسه یکتای مالیاتی" کپی کنید و کلید خصوصی مرحله اول را نیز در فیلد بعدی نرم افزار تنظیم نمایید.


راهنمای ویدئویی این مراحل را میتوانید در زیر ببینید:

.. raw:: html

    <div id="29925543730"><script type="text/JavaScript" src="https://www.aparat.com/embed/o12At?data[rnddiv]=29925543730&data[responsive]=yes"></script></div>

|


.. |gen_csr| raw:: html

    <a href="https://mtax.mohsensoft.com/CreateCSR" target="_blank">https://mtax.mohsensoft.com/CreateCSR</a>


.. |membership_normalUniqueID| raw:: html

    <a href="https://tp.tax.gov.ir/membership/normalUniqueID" target="_blank">https://tp.tax.gov.ir/membership/normalUniqueID</a>

|

.. note::
    * قبل از اقدام به ارسال صورتحساب بهتر است قوانین و راهنمای ارسال به سامانه مودیان مالیاتی را از لینک های زیر دانلود و مطالعه نمایید،
    * در نرم افزار سعی شده است تا حد امکان خطاها و تذکرات لازم برای اطلاعات وارد شده قبل از ارسال آن داده شود ولی بهتر است همه این موارد را مطالعه و بررسی نمایید:
    * 
    * |intamedia_docs|


.. |intamedia_docs| raw:: html

    <a href="https://www.intamedia.ir/The-regulation-of-store-terminals" target="_blank">https://www.intamedia.ir/The-regulation-of-store-terminals</a>


.. _send:

ارسال به سامانه مودیان
----------------------------
| برای ارسال صورتحساب به سامانه مودیان مالیاتی از دو طریق میتوانید این کار را انجام دهید:

* **روش اول** باز کردن یک فاکتور و ارسال آن توسط گزینه "ارسال فاکتور" در نوار عمومی پنجره اصلی.
* **روش دوم** اتخاب گزینه"وضعیت" در نوار عمومی از بخش سامانه مودیان و سپس انتخاب گزینه "وارد کردن مورد جدید بصورت دستی" برای وارد کردن اطلاعات بدون فاکتور ذخیره شده است، در این حالت میتواید اقلام صورتحساب را از طریق فایل اکسل نیز وارد نمایید.

پس از انجام روش اول نرم افزار بصورت خودکار شروع به تطبیق ستونهای فاکتور با ستونهای صورتحساب مورد نیاز سامانه میکند، اگر در این کار ستونی شناسایی نشد پنجره زیر باز خواهد شد:

.. image:: images/mtax_map.png
    :alt:  ارتباط به سامانه مودیان
    :align: center

در این پنجره میبایست ستون های مورد نیاز سامانه را نسبت به ستونهای جدول فاکتور مشخص نمایید تا اقلام آن به پنجره ارسال سامانه منتقل شود.

تنظیمی که در این پنجره انجام میدهید برای برگه ذخیره خواهد شد و در دفعالت بعدی نیازی به تنظیم آن نیست و این پنجره نمایش داده نخواهد شد.

در صورتی که این پنجره نمایش داده نشد و یا قصد تغییر در آن را دارید میتوانید از منوی اصلی پنجره بعدی این پنجره را مجدد باز نمایید.

.. image:: images/mtax_send.png
    :alt:  ورود اطلاعات سامانه مودیان
    :align: center

در این پنجره همه اطلاعاتی که برای ارسال به سامانه مودیان نیاز دارید را میبایست وارد کنید، اگر نرم افزار خطا، هشدار یا توضیحی برای اطلاعات وارد شده تان تشخیص دهید آن را در کادر پایین همین پنجره نمایش می دهد،
شما با کلیک بر روی هر پیام به فیلدی که این پیام مربوط به آن است منتقل میشوید، همچنین در زیر کادر هر فیلد در صورت وجود خطا، هشدار یا اطلاعات نواری به همان رنگ نمایش داده میشود.

پس از وارد کردن همه اطلاعات و صحیح بودن آن گزینه "ارسال" فعال خواهد شد، با انتخاب این گزینه اگر لایسنس مربوط به کد اقتصادی فروشنده وارد شده نصب شده باشد اطلاعات برای ارسال به پنجره بعد منتقل میشود تا در صف ارسال قرار گیرد:

.. note::
    * برای تهیه لایسنس از لینک زیر استفاده نمایید:
    * |taxmoadi|

.. |taxmoadi| raw:: html

    <a href="https://mohsensoft.com/product/taxmoadi" target="_blank">https://mohsensoft.com/product/taxmoadi</a>

.. image:: images/mtax.png
    :alt:  ارسال به سامانه مودیان
    :align: center

در این پنجره همه ارسال ها به سامانه مودیان با در نظر گرفتن فایل فاکتور دسته بندی شده اند، این دسته بندی به این منظور است که تمام ارسال های مربوط به هر فایل در یک گروه قرار گیرند، برای مثال همه ارسال های فروش، ابطالی، اصلاحی و برگشت از فروش هر فایل در یک گروه قرار میگیرند تا مدیریت بهتری بر آن داشته باشید.

نکته ها
-------------
* شماره فاکتور طبق قوانین سامانه میبایست یک مقدار عددی و به ترتیب باشد، این شماره برای هر شناسه حافظه مالیاتی مستقل میباشد
* طبق قوانین ارسال صورتحساب مهلت مشخص دارد و ارسال صورتحساب های قدیمی تر از آن با خطا مواجه خواهد بود.


.. _fix-errors:

رفع خطا
-------------
در سامانه کنونی معمولا خطای اتفاق افتاده با شرح برگشتی و یا نتیجه تبادل ارتباط همخوانی ندارد، برای مثال ممکن است با تنظیم شناسه  یکتای مالیاتی نادرست خطای 500 شبکه دریافت نمایید!

و یا با رعایت نکردن ترتیب شماره فاکتور برای هر شناسه حافظه مالیاتی هشدار عدم تطابق شناسه یکتای مالیاتی دریافت نمایید.

پس در بروز هر خطا میبایست تمامی موارد یک ارسال را مورد بررسی قرار دهید. سعی میشود به مرور شایعترین خطاها و روش روفع آن در ادامه همین صفحه افزوده گردد.

اگر به هر دلیل در ارسال دچار مشکل شدید ابتدا تمام موارد زیر را چک نمایید:

* چک کنید از آخرین آپدیت نرم افزار فاکتور استفاده می کنید.
* شماره اقتصادی فروشنده همان شماره اقتصادی نوشته شده در قسمت بالا و سمت راست سامانه مودیان باشد.
* شماره اقتصادی خریدار وارد شده باشد و نه شناسه ملی آن.
* شناسه ملی خریدار را بصورت صحیح وارد کنید.
* شناسه یکتا را در قسمت مشخصات فروشنده صحیح وارد کرده باشید.
* در فیلد آدرس ارسال سامانه در قسمت مشخصات فروشنده گزینه سندباکس انتخاب نباشد.
* تاریخ فاکتور بیشتر از یک ماه قدیمی نباشد.
* تاریخ سیستم صحیح و بروز باشد.
* در پنجره ارسال صورتحساب تاریخ و زمان صدور و ایجاد صورتحساب بیشتر از زمان حاضر نباشد.

پس از تغییر هرکدام از این موارد میباست صورتحساب را از ابتدا ارسال نمایید.